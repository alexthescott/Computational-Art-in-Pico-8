pico-8 cartridge // http://www.pico-8.com
version 33
__lua__
-- lofi 3d 2
-- alexthescott

-- based on 3d demo
-- by @noahrosamilia

-- circle maths 
-- https://www.cmu.edu/biolphys/deserno/pdf/sphere_equi.pdf

-- new seed every day of the year 
srand(31*stat(81)+stat(82)) 

p1={7,6,135,10,138,11,139,3,131,12,140,1,129,130,128,0}
p2={7,135,10,9,15,143,142,137,14,136,8,2,130,133,128,0}
p3={7,15,143,142,14,8,136,137,9,10,135,138,11,139,12,140}

p={p1,p2,p3}
c=rnd(p)

pal(c,1)

function draw_shape(s)
	for i,l in ipairs(s[2]) do
		draw_line(s[1][l[1]],s[1][l[2]],i)
	end
end

function draw_line(p1,p2,c)
	x0,y0=project(p1)
	x1,y1=project(p2)
	line(x0,y0,x1,y1,c)
end

function draw_point(p,c)
	x,y=project(p)
	pset(x,y,c)
end

function project(p)
	-- calculate x,y and center it
	x=(p[1]-cam[1])*mult/(p[3]-cam[3])+127/2
	y=-(p[2]-cam[2])*mult/(p[3]-cam[3])+127/2
	return x,y
end

function translate_shape(s,t)
	-- copy shape, 0 out points,
	-- keep og lines
	ns={{},s[2]}
	-- add displacement to point
	for p in all(s[1])do
		add(ns[1],{p[1]+t[1],p[2]+t[2],p[3]+t[3]})
	end
	return ns
end

function rotate_shape(s,a,r)
	-- copy shape, 0 out points
	-- keep og lines
	ns={{},s[2]}
	for p in all(s[1])do
		add(ns[1],rotate_point(p,a,r))
	end
	return ns
end

function rotate_point(p,a,r)
	-- figure axis we're rotating
	if a==1 then
		x,y,z=3,2,1
	elseif a==2 then
		x,y,z=1,3,2
	elseif a==3 then
		x,y,z=1,2,3
	end
	
	_x=cos(r)*p[x]-sin(r)*p[y]
	_y=sin(r)*p[x]+cos(r)*p[y]
	np={}
	np[x]=_x
	np[y]=_y
	np[z]=p[z]
	return np
end

function limit_int(v,l)
	if v>0 then
		return min(v,l)
	else
		return max(v,-l)
	end
end

function burn()
	for p=0,384 do
		x=rnd(128)\1
		y=rnd(128)\1
		pc=pget(x,y)
		if pc!=0 then
			pset(x,y,pc-1)
		else
			pset(x,y,0)
		end
	end
end

function fuzz(big)
	if big then
		sz=10
		cnt=512
	else
		sz=3
		cnt=384
	end

	for p=0,cnt do
		x=rnd(128)\1
		y=rnd(128)\1
		pc=pget(x,y)
		if pc!=0 then
			for l=1,rnd(sz)\1 do
			pset(x-l,y,pc)
			pset(x+l,y,pc)
			end
		end		
	end
end

function forward()
	v=c[1]
	del(c,v)
	c[#c+1]=v
	pal(c,1)
end

function backward()
	v=c[#c]
	del(c,v)
	for i=#c+1,1,-1 do
		if i!=1 then
			c[i]=c[i-1]
		else
			c[i]=v
		end
	end
	pal(c,1)
end

function add_point(shape)
	z=rnd(2)-1
	a=rnd()
	x=sqrt(2-z^2)*cos(a)
	y=sqrt(2-z^2)*sin(a)
	p={x,y,z}
	add(shape[1],p)
	if #shape[1]>1 then
		i=#shape[1]
		add(shape[2],{i-1,i})
	end
end

function rm_point(shape)
	del(shape[1],shape[1][#shape[1]])
	del(shape[2],shape[2][#shape[2]])
end

for i=1,rnd()*16 do
	forward()
end


for p=1,24 do
	po={p,p+1}
end

cam={0,0,-2}
mult=64

cir={{},{}}
add_point(cir)
add_point(cir)

remove_points=false

month=stat(81)
day=stat(82)
cls()
_set_fps(60)
::♥::
if t()<2 then
	print("lofi 3d 2",46,59,1)
	print(month.."/"..day,55,65)
else

	if remove_points==false
		and t()%0.5==0 then
			add_point(cir)
	end
	
	if remove_points==false
		and #cir[1]>=64 then
			remove_points=true
	end
	
	if remove_points==true and
		t()%0.25==0 and
		#cir[1]>=1 then
			rm_point(cir)
	elseif #cir[1]<=1 and
		remove_points==true then
			remove_points=false		
	end
	
	cls()
	
	if btn(⬅️) then cam[1] -= 0.1 end
	if btn(➡️) then cam[1] += 0.1 end
	if btn(⬆️) then cam[2] += 0.1 end
	if btn(⬇️) then cam[2] -= 0.1 end
	if btn(❎) then cam[3] -= 0.1 end
	if btn(🅾️) then cam[3] += 0.1 end
	
	if btn(⬆️) and btn(⬇️) or
		btn(➡️) and btn(⬅️) then
			print("cam.x="..cam[1],0,0,2)
			print("cam.y="..cam[2],0,6,2)
			print("cam.z="..cam[3],0,12,2)
	end
	
	cir=rotate_shape(cir,1,0.001)
	cir=rotate_shape(cir,2,0.001)
	draw_shape(cir)
end
flip()
goto ♥
__label__
88888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
88888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
88888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
88888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
88888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
88888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
88888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
88888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
88888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
88888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
88888888888888888888888888888888888888888988888888888888888888888888888888888888888888888888888888888888888888888888888888888888
88888888888888888888888888888888888888888988888888888888888888888888888888888888888888888888888888888888888888888888888888888888
8888888888888888888888888888888888888888p898888888888888888888888888888u88888888888888888888888888888888888888888888888888888888
8888888888888888888888888888888888888888p89888888888888888888888888888vu88888888888888888888888888888888888888888888888888888888
888888888888888888888888888888888888888p888988888888888888888888888888v8u888888888b888888888888888888888888888888888888888888888
888888888888888888888888888888888888888p88898888888888888888888888888v88u8888888bbq888888888888888888888888888888888888888888888
88888888888888888888888888888888888888p88888988888888888888888888888v888u888888b88q888888888888888888888888888888888888888888888
88888888888888888888888888888888888888p88888988888888888888888888888v8888u888bb888q888888888888888888888888888888888888888888888
8888888888888888888888888888888888888p88888889888888888888888888888v88888u88b888888q88888888888888888888888888888888888888888888
8888888888888888888888888888888888888p88888889888888888888888888888v88888ubb8888888q88888888888888888888888888888888888888888888
888888888888888888888888888888888888p8888poooo9ooooooooooooooooooovoooooobuoooo8888q88888888888888888888888888888888888888888888
888888888888888888888888888888888888p8888p88889888888888888888888v88888bb8u88888888q88888888888888888888888888888888888888888888
88888888888888888888888888888888888p888888p8888988888888888888888v888bb888u88888888q88888888888888888888888888888888888888888888
88888888888888888888888888888888888p888888p888s9c888888888888888v888b888888u8888888q88888888888888888888888888888888888888888888
8888888888888888888888888888888888p8888888p88s88988888888888888v88bb8888888u8888o88q88888888888p88888888888888888888888888888888
8888888888888888888888888888888888p88888888ps8889c8888888888888v8b8888888888u8oo8888q888888888p8o8888888888888888888888888888888
888888888888888888888888888888888p888888888s888889c88888888888vbb88888888888uo888888q88888888p8888888888888888888888888888888888
888888888888888888888888888888888p88888888sp888889c8888888888vb8888888888888o8888888q8888888p88888888888888888888888888888888888
88888888888888888888888888888888p88888888s88p888889c88888888bb888888888888oo88888888q888888p888888888888888888888888888888888888
88888888888888888888888888888888p8888888s888p8888898c888888bv888888888888o888u888888q88888p8888888888888888888888888888888888888
8888888888888888888888888888888p88888888s888p88888898c888bbv88888888888oo8888u888888q8888p88888888888888888888888888888888888888
8888888888888888888888888888888p8888888s88888p8888898c88b88v8888888888o8888888u888888q88p8888888888888888888888888888a8888888888
888888888888888888888888888888p8888888s888888p88888898cb88v8888888888o88888888u888888q8p8888888888888888888888888888a88888888888
888888888888888888888888888888p888888s8888888p8888889b8c88v88888888oo888888888u888888qp8888888888888888888888888888a888888888888
88888888888888888888888888888p888888s888888888p8888bb98c8v88888888o888888888888u8888pq8888888888888888888888888889a8888888888888
88888888888888888888888888888p88888s8888888888p888b88988c88888888o8888888888888u888p8q888888888888888888888888889a88888888888888
8888888888888888888888888888p88888s88888888888p8bb888988vc88888oo88888888888888u88p88q88888888888888888888888889a888888888888888
8888888888888888888888888888p8888s8888888888888b8888889v8c8888o88888888888888888up888q888888888888888888888888aa8888888888888888
888888888888888888888888888p8888s888888888888bbp8888889888c8oo888888888888888888p88888q8888888888888888888888n888888888888888888
888888888888888888888888888p888s88888888888bb88p888888v9888o8888888888888888888pu88888q88888888888888888888aan888888888888888888
88888888888888888888888888p888s88888888888b88888p8888v8988oc888888888888888888p88u8888q888888888888888888aaa8n888888888888888888
88888888888888888888888888p88s8888888888bb888888p888v8889o88c8888888888888888p888u8888q88888888888888888a9a8n8888888888888888888
8888888888888888888888888p88s8888888888b88888888p888v88o98888c88888888888888p8888u8888q888888888888888aa9a88n8888888888888888888
8888888888888888888888888p8s888888888bb8888888888p8v8oo889888c8888888888888p888888u888q8888888888888aa89a888n88888888888s8888888
888888888888888888888888p88s88888888b888888888888p8vo888898888c88888888888p8888888u888q888888888888a889a8888n8888888888s88888888
888888888888888888888888p8s8888888bb8888888888888pvo88888898888c888888888p888888888u888q888888888aa889a8888n88888888888s88888888
88888888888888888888888p8s8888888r888888888888888oo8888888988888c8888888p8888888888u888q8888888aa8899a88888n8888888888s888888888
88888888888888888888888ps888888888r8888888888888ovp8888888898888c888888p88888888888u888q888888a88888a888888n888888888sc888888888
8888888888888888888888ps88888888888rr8888888888ov8p88888888988888c8888p8888888888888u88q8888aa88898a8888888n888888888s8888888888
8888888888888888888888p88888888888888r8888888oov888p88888888988888c88p88888888888888u88q888a88889a888888888n88888888s88888888888
888888888888888888888p8888888888888888r88888o88v888p88888888988888c8p888888888888888u88q8aa88889ae88888888n88888888sc8888888u888
88888888888888888888sp88888888888888888r88oo88v88888p88888888988888c88888888888888888u8aq888889ee888888888n88888888s888888uu8888
8888888888888888888sp8888888888888888888ro888v888888p8888888898888p8c8888888888888888ua8q888eee88888888888n8888888sc8888uuv88888
888888888888888888s8p8888888888888888888o8r88v888888p88888888898pp88c888888888888888aa88q8ee8a888888888888n888888sc888uuvv888888
88888888888888888s8p888888888888888888oo888rv88888888p888888889p88888c888888888888aa88u8qe98a888888888888n888888sc88uu8v88888888
8888888888888888s88p88888888888888888o888888rr8888888888888888p9888888c8888888888a8888eeq98a8888888888888n888888scuu88v888888888
888888888888888s88p8888888888888888oo888888v88r88888888888888p89888888c88888888aa8888888q8a88888888888888n88888suu888v8888888888
88888888888888s888p888888888888888o8888888v8888r888888p88888p8889888888c88888aa888888889qa888888888888888n8888uuc888v88888888888
88888888888888s88p888888888888888o88888888v88888r88888p8888p888898888888c888a88888888998aq888888888888888n888usc88vv888888888888
8888888888888s888p8888888888888oo88888888v8888888r8888p888p8888898888888c8aa8888888898aa8q88888888888888n88uusc88v88888888888888
888888888888s888p8888888888888o888888888v8888888888r888p8p88888889888888ac88888888898a888q88888888888888nuu8s8c8v888888888888888
88888888888s8888p888888888888o8888888888v88888888888r88pp88888888988888a88c888888898a8888q8888888888888uu888sc8v8888888888888bbr
8888888888s8888p88888888888oo8888888888v8888888888888r8p8888888888988aa8888c8888898a88888q88888888888uu8n88s8cv8888888888bbbb8r8
888888888s88888p8888888888o88888888888v888888888888888rrp8888888889aa888888c888898a888888q888888888uu88n88s8vv8888888bbbb8888r88
88888888s88888p888888888oo888888888888v88888888888888p88r888888888a988888888c8998a8888888q8888888uu8888n88sv8888bbbbb8888888r888
88888887888888p88888888o8888888888888v88888888888888p888pr888888aa89888888888c88a888888888q8888uu888888n8svcbbbb88888888888r8888
8888888878888p88888888o8888888888888v88888888888888p88888pr8888a8888988888889c8a8888888888q888u88888888nsvcb888888888888888r8888
8888888887888p888888oo88888888888888v8888888888888p888888p8rraa888889888888988c88888888888q8uu88888bbbbnv8c888888888888888r88888
888888888878p888888o888888888888888v8888888888888p8888888p8aar888888898888988a8c8888888888uu888bbbb888vv8c888888888888888r888888
888888888887p8888oo8888888888888888v888888888888p888888888a888r8888889888988a88c88888888uuqbbbb888888vn8c888888888888888r8888888
88888888888p7888o88888888888888888v888888888888p88888888aap8888r8888889998aa8888c88888uubbq888888888v8n8c88888888888888r88888888
88888888888p878o88888888888888888v888888888888p8888888aa88p88888rr8888988a8888888cbbuu88888q8888888v8snc88888888888888r888888888
8888888888p88oo888888888888888888v88888888888p8888888a88888p888888r88989a8888bbbbcuu8888888q888888v8sn8c8888888888888r8888888888
8888888888p8o8878888888888888888v8888888888pp88888889888888p8888888r98898bbbb888uuc88888888q8888vv8s8nc8888888888888r88888888888
888888888p8o8888788888888888888v8888888e88p8888888998888888p88888889rrbb9888888u888c8888888q888v888s8n88888888888888r88888888888
888888888po88888878888888888888v8888888e8p888888898888888888p888bbbb8ar898888uu8888c8888888q88v888s88n8888888888888r888888888888
88888888p888888888788888888888v888888888e888888898888888888bbbbb998nn88r898uu8888888c888888q8v888s88cn888888888888r8888888888888
88888888888888888887888888888v888888888p8e8888998888888bbbb8p889nnn88888r9u8888888888c88888ff8888s88n888888888888r88888888888888
88888888888888888888788888888v88888888p88e888988888bbbb888888nnn8888888uur988888888888c888f8q888s88cn88888888888r888888888888888
8888888888888888888887888888v88888888p8888e898bbbbb88888888nn98888888uu8889r8888888888c88f88q88s88c8n8888888888r8888888888888888
8888888888888888888888788888v8888888p888889ebb8888888888nnn88888888uu8888889r8888888888ff888q88s88c8n888888888r88888888888888888
888888888888888888888887888v8888888p8bbbb98e888888888nnn888888888uu8888888898r88888888f8c888q8s88c8n888888888r888888888888888888
88888888888888888888888878v888888bpbb8889888e888qqqqn88888888888u8888888888898rr88888f88c888qs888c8n888888888r888888888888888888
88888888888888888888888887v88bbbbp8888998qqqeqqq88888888888888uu8888888888889888r88ff8888c88qs88c88n88888888r8888888888888888888
888888888888888888888888bv7bb888p88qq9qqq8888e88888888888888uu8888888888888898888rf8888888c8q88c888n8888888r88888888888888888888
88888888888888888888bbbbv887qqqpqqq89888888888e88888888888uu888888888888888889888fr8888888cs8q8c888n888888r888888888888888888888
888888888888888bbbbb8qqqvqqq78p888998888888888e888888888uu888888888888888888898ff88rr888888c8qc888n888888r8888888888888888888888
88888888888bbbbqqqqqq88v88888788898888888888888e888888uu88888888888888888888889888888r8888s8cq8888n88888r88888888888888888888888
8888888bbbbqqqq8888888v88888p8789888888888888888e888uu88888888888888888888888f98888888r88s88cq8888n8888r888888888888888888888888
8888bbbq88888888888888v8888p88978888888888888888e8uu88888888888888888888888ff8898888888r8s88cc8888n888r8888888888888888888888888
888888888888888888888v8888p8898878888888888888888e888888888888888888888888f8888988888888rr88cqc88n8888r8888888888888888888888888
88888888888888888888v8888p88988887888888888888888888888888888888888888888f8888889888888s88rc88c88n888r88888888888888888888888888
88888888888888888888v88pp8998888887888888888888888888888888888888888888ff8888888988888s888cr88qc8n88r888888888888888888888888888
8888888888888888888v88p77978888888878888888888888888888888888888888888f888888888898888s888c8rrq8cn8r8888888888888888888888888888
8888888888888888888v8p88988777777778788888888888888888888888888888888f888888888889888s888c8888r88cr88888888888888888888888888888
888888888888888888vfp8998888888888877777777788888888888888888888888ff888888888888898s8888c8888qrnc888888888888888888888888888888
88888888888888888vfp8988888888888888887888887777777788888888888888f88888888888888898s888c88888q8r8c88888888888888888888888888888
88888888888888888vp8988888888888888888878888888888887777777788888f888888888888888889888c888888qrnrrc8888888888888888888888888888
8888888888888888vp998888888888888888888878888888888888888888777ff77778888888888888s9888c8888888qn88c8888888888888888888888888888
8888888888888888p988888888888888888888888788888888888888888888f8888887777777788888s898c8888888rq8888c888888888888888888888888888
888888888888888p988888888888888888888888887888888888888888888f888888888888888777778898c888888r8q88888888888888888888888888888888
88888888888888998888888888888888888888888887888888888888888ff8888888888888888888888889888888r88q88888888888888888888888888888888
8888888888888988888888888888888888888888888878888888888888f8888888888888888888888888c988888r888888888888888888888888888888888888
888888888888888888888888888888888888888888888788888888888f88888888888888888888888888c89888r8888888888888888888888888888888888888
8888888888888888888888888888888888888888888888788888888ff88888888888888888888888888c88988r88888888888888888888888888888888888888
888888888888888888888888888888888888888888888887888888f8888888888888888888888888888c8889r888888888888888888888888888888888888888
88888888888888888888888888888888888888888888888878888f8888888888888888888888888888c88889r888888888888888888888888888888888888888
888888888888888888888888888888888888888888888888878ff8888888888888888888888888888c88888r9888888888888888888888888888888888888888
88888888888888888888888888888888888888888888888888f888888888888888888888888888888c8888r89888888888888888888888888888888888888888
88888888888888888888888888888888888888888888888888888888888888888888888888888888c8888r888888888888888888888888888888888888888888
88888888888888888888888888888888888888888888888888888888888888888888888888888888c888r8888888888888888888888888888888888888888888
8888888888888888888888888888888888888888888888888888888888888888888888888888888c888r88888888888888888888888888888888888888888888
888888888888888888888888888888888888888888888888888888888888888888888888888888c888r888888888888888888888888888888888888888888888
888888888888888888888888888888888888888888888888888888888888888888888888888888c88r8888888888888888888888888888888888888888888888
88888888888888888888888888888888888888888888888888888888888888888888888888888c888r8888888888888888888888888888888888888888888888
88888888888888888888888888888888888888888888888888888888888888888888888888888c88r88888888888888888888888888888888888888888888888
8888888888888888888888888888888888888888888888888888888888888888888888888888c88r888888888888888888888888888888888888888888888888
888888888888888888888888888888888888888888888888888888888888888888888888888c88r8888888888888888888888888888888888888888888888888
888888888888888888888888888888888888888888888888888888888888888888888888888c8r88888888888888888888888888888888888888888888888888
88888888888888888888888888888888888888888888888888888888888888888888888888c8r888888888888888888888888888888888888888888888888888
88888888888888888888888888888888888888888888888888888888888888888888888888cr8888888888888888888888888888888888888888888888888888
8888888888888888888888888888888888888888888888888888888888888888888888888cr88888888888888888888888888888888888888888888888888888
888888888888888888888888888888888888888888888888888888888888888888888888c8r88888888888888888888888888888888888888888888888888888
888888888888888888888888888888888888888888888888888888888888888888888888cr888888888888888888888888888888888888888888888888888888
88888888888888888888888888888888888888888888888888888888888888888888888cr8888888888888888888888888888888888888888888888888888888
88888888888888888888888888888888888888888888888888888888888888888888888c88888888888888888888888888888888888888888888888888888888
8888888888888888888888888888888888888888888888888888888888888888888888c888888888888888888888888888888888888888888888888888888888
88888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888

